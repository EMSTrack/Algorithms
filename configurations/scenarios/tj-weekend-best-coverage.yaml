#
# Define name of the simulation. Used in file system naming.
#
name: tj-weekend-best-coverage


#
# Define how the source data is used:
#
demands:
  class: ems.datasets.demand.DemandSet
  filename: ../data-cruz-roja-clean/demand_points.csv

all_bases:
  class: ems.datasets.base.BaseSet
  filename: ../data-cruz-roja-clean/bases.csv

tt:
  class: ems.datasets.times.TravelTimes
  filename: ../data-cruz-roja-clean/times.csv
  origins: $all_bases
  destinations: $demands

# Selects a subset of bases for usage in the simulation (K-Means filtered)
simulation_bases:
  class: TODO -- replace
  filename: "../data-cruz-roja-clean/bases.csv"

#
# Define the zones for multi-polygon case generation 
#
tj-zones: 
  class: ems.generators.location.MultiPolygonLocationGenerator
  longitudes_file: "../longitudes.yaml"
  latitudes_file: "../latitudes.yaml"

#
# Define how EMS agents are selected
#
ambulances:
  class: ems.datasets.ambulance.BaseSelectedAmbulanceSet
  count: 12

  base_selector:
    class: ems.algorithms.base.RoundRobinBaseSelector
    base_set: $simulation_bases

hospitals:
  class: ems.datasets.hospital.HospitalSet
  latitudes: [32.52506901611384, 32.5027, 32.5180]
  longitudes: [-117.0097589492798, -117.00371, -117.0078]

event_gen:
  class: ems.generators.event.EventGenerator

  # Travel times between events estimated using travel times matrix
  travel_duration_generator:
    class: ems.generators.duration.TravelTimeDurationGenerator
    travel_times: $tt
    epsilon: 0.001

  # Duration at incident drawn from uniform distribution between 5 and 10 minutes
  incident_duration_generator:
    class: ems.generators.duration.RandomDurationGenerator
    lower_bound: 5
    upper_bound: 10

  # Duration at hospital drawn from uniform distribution between 5 and 10 minutes
  hospital_duration_generator:
    class: ems.generators.duration.RandomDurationGenerator
    lower_bound: 5
    upper_bound: 10

  hospital_selector: # Fastest hospital chosen
    class: ems.algorithms.hospital.FastestHospitalSelector
    hospital_set: $hospitals
    travel_times: $tt


#
#
#
cases:
  class: ems.datasets.case.CSVCaseSet
  filename: ./results/tj-weekend-best-travel/processed_cases.csv
  event_generator: $event_gen


#
# Simulator configurations: How data is accumulated and how the simulator is run.
#
metric_aggregator:
  class: ems.analysis.metrics.MetricAggregator

  metrics:
    - class: ems.analysis.coverage.PercentDoubleCoverage
      r1: 600
      demands: $demands
      travel_times: $tt
    - class: ems.analysis.metrics.TotalDelay
    - class: ems.analysis.metrics.CountPending

simulator:
  class: ems.simulators.simulator.EventDispatcherSimulator
  debug: False
  ambulances: $ambulances
  cases: $cases

  ambulance_selector:
    class: ems.algorithms.ambulance.LeastDisruption
    travel_times: $tt
    demands: $demands

  metric_aggregator: $metric_aggregator
